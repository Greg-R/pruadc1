%    Documentation for PRU ADC Project
%    Copyright (C) 2016  Gregory Raven
%
%    This program is free software: you can redistribute it and/or modify
%    it under the terms of the GNU General Public License as published by
%    the Free Software Foundation, either version 3 of the License, or
%    (at your option) any later version.
%
%    This program is distributed in the hope that it will be useful,
%    but WITHOUT ANY WARRANTY; without even the implied warranty of
%    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%    GNU General Public License for more details.
%
%    You should have received a copy of the GNU General Public License
%    along with this program.  If not, see <http://www.gnu.org/licenses/>.

\chapter{Setting up the PRU Compiler on the Beaglebone Green}

The following describes the simplest possible set-up.  Everything was done via the command line, and the vim editor was used extensively to develop the C code and shell scripts.

SSH was used to remotely access the BBG from a 64 bit desktop computer running Ubuntu 14.04.

For reference, here is the link to the TI PRU support package:

\url{https://git.ti.com/pru-software-support-package}

The above package can be cloned to the BBG.  There is a good set of examples and labs included.  The labs are documented here:

\url{http://processors.wiki.ti.com/index.php/PRU_Training:_Hands-on_Labs}

Note that the files appropriate for the BBG are in the folders with name am335x.

The Makefiles in the labs and examples were designed to work with a particular set-up which can be easily implemented on the BBG.

The following is a list of recommended steps to prepare a BBG for compiling PRU C files.

\begin{enumerate}
\item Flash IOT image to micro-sd.
\item  Insert micro-sd into BBG slot, press boot and power buttons and release.
\item  ssh root@192.168.1.7 (or whatever the IP is set to)
\item  uname -r to verify kernel -> 4.4.9-ti-r25  Make sure it is the desired kernel!
\item  apt-get update
\item  cd / and then find . -name cgt-pru, and the path is /usr/share/ti/cgt-pru.  This is the location of the PRU library and includes.
However, the clpru compiler binary is not there:
which clpru
/usr/bin/clpru
So the compiler binary is in a different location.  This is a problem for the labs make files.
cd /usr/share/ti/cgt-pru
mkdir bin
cd bin
ln -s /usr/bin/clpru clpru
So now the make files will find the compiler executable in the correct location via the link.
\item  cd /home/debian
git clone git://git.ti.com/pru-software-support-package/pru-software-support-package.git
This will clone a copy of the latest pru support package.
\item  cd into lab\_5 in the package:
cd lab\_5/solution/PRU\_Halt
make
This will fail, it is looking for environment variable \$PRU\_CGT
export PRU\_CGT=/usr/share/ti/cgt-pru
Now try make again.  It should succeed.
\item  cd gen
cp PRU\_Halt.out am335x-pru0-fw
cp am335x-pru0-fw /lib/firmware
\item  Now cd into the PRU\_RPMsg\_Echo\_Interrupt1 directory in the same lab\_5.
Edit main.c as follows:
//\#define CHAN\_NAME					"rpmsg-client-sample"
\#define CHAN\_NAME					"rpmsg-pru"
\item  Now almost the same as \#9, this time for pru1:
cd gen
cp PRU\_RPMsg\_Echo\_Interrupt1.out am335x-pru1-fw
cp am335x-pru1-fw /lib/firmware
\item  Reboot
\item  cd /dev look for rpmsg\_pru31 device file.  It will be there!
\end{enumerate}


